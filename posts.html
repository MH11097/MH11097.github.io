<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Posts - MH11097 Blog</title>
    <link href="https://fonts.googleapis.com/css?family=Inconsolata:400,700&subset=latin-ext,vietnamese" rel="stylesheet">
    <link href="assets/css/theme.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="assets/css/highlight/tomorrow-night.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <style>
        body {
            font-family: 'Inconsolata', monospace;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
            background: #fafafa;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 60px;
            padding-bottom: 10px;
        }
        
        .logo {
            font-weight: bold;
            font-size: 18px;
            color: #333;
            text-decoration: none;
        }
        
        .breadcrumb {
            color: #999;
            font-size: 14px;
        }
        
        .nav {
            display: flex;
            gap: 30px;
        }
        
        .nav a {
            color: #666;
            text-decoration: none;
            font-size: 14px;
            transition: color 0.3s ease;
        }
        
        .nav a:hover, .nav a.active {
            color: #333;
        }
        
        .language-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #333;
            color: white;
            border: none;
            border-radius: 25px;
            padding: 8px 20px;
            font-family: 'Inconsolata', monospace;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        
        .language-toggle:hover {
            background: #555;
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        
        .language-indicator {
            display: inline-block;
            margin-right: 5px;
            font-size: 14px;
        }
        
        .main-content {
            opacity: 1;
            transform: translateX(0);
            transition: all 0.4s cubic-bezier(0.4, 0.0, 0.2, 1);
        }
        
        .main-content.switching {
            opacity: 0;
            transform: translateX(-30px);
        }
        
        .page-title {
            font-size: 42px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        
        .page-subtitle {
            color: #666;
            margin-bottom: 50px;
            font-size: 16px;
        }
        
        .section-title {
            font-size: 24px;
            font-weight: bold;
            margin: 40px 0 20px 0;
            color: #333;
        }
        
        .posts-list {
            list-style: none;
            padding: 0;
        }
        
        .post-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 12px;
            padding: 8px 0;
            border-bottom: 1px solid transparent;
            transition: border-color 0.3s ease;
        }
        
        .post-item:hover {
            border-bottom-color: #eee;
        }
        
        .post-date {
            color: #999;
            font-size: 14px;
            margin-right: 20px;
            flex-shrink: 0;
            font-family: monospace;
        }
        
        .post-title {
            color: #333;
            text-decoration: none;
            flex: 1;
        }
        
        .post-title:hover {
            color: #666;
        }
        
        .category-header {
            font-size: 18px;
            font-weight: bold;
            color: #666;
            margin: 30px 0 15px 0;
        }
        
        .category-posts {
            margin-left: 20px;
        }
        
        .back-button {
            margin-bottom: 20px;
        }
        
        .back-button a {
            color: #0066cc;
            text-decoration: none;
        }
        
        #post-content {
            display: none;
        }
        
        .footer {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 40px;
            border-top: 1px solid #eee;
            color: #666;
            font-size: 14px;
            margin-top: 60px;
            text-align: center;
            gap: 15px;
        }
        
        .footer-quote {
            font-style: italic;
            color: #999;
            margin-bottom: 10px;
        }
        
        .footer-links {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .footer-links a {
            color: #666;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .footer-links a:hover {
            color: #333;
        }
        
        .rss-link {
            color: #e74c3c;
            text-decoration: none;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <button class="language-toggle" onclick="toggleLanguage()">
        <span class="language-indicator">üá∫üá∏</span>
        English
    </button>

    <div class="header">
        <div>
            <a href="/" class="logo">MH11097</a>
            <span class="breadcrumb">/posts</span>
        </div>
        <nav class="nav">
            <a href="posts.html" class="active" data-en="Posts" data-vi="B√†i vi·∫øt">Posts</a>
            <a href="cv.html">CV</a>
        </nav>
    </div>

    <div id="blog-content" class="main-content">
        <div id="post-list">
            <h1 class="page-title">posts: Development Log</h1>
            <p class="page-subtitle">Technical Blog & Project Documentation</p>
            
            <h2 class="section-title">Recently Added</h2>
            <ul class="posts-list" id="recent-posts">
                <!-- Posts will be loaded here dynamically -->
            </ul>

            <h2 class="section-title">Posts by categories</h2>
            <div id="categories-section">
                <!-- Categories will be loaded here -->
            </div>
        </div>

        <div id="post-content">
            <div class="back-button">
                <a href="#" onclick="showPostList()">&larr; Back to posts</a>
            </div>
            <div id="single-post"></div>
        </div>
    </div>

    <footer class="footer" id="footerContent">
        <div>üè† @MH11097</div>
        <a href="https://github.com/MH11097" class="rss-link">üìö GitHub</a>
    </footer>

    <script>
        let posts = [];
        let categories = {};

        function formatDate(dateStr) {
            try {
                const date = new Date(dateStr);
                return date.toLocaleDateString('en-GB', { 
                    day: '2-digit', 
                    month: '2-digit', 
                    year: 'numeric' 
                }).replace(/\//g, '.');
            } catch {
                return dateStr;
            }
        }

        function parseMarkdownMetadata(content) {
            const lines = content.split('\n');
            if (lines[0] !== '---') return { metadata: {}, content };
            
            const metadata = {};
            let i = 1;
            while (i < lines.length && lines[i] !== '---') {
                const line = lines[i].trim();
                if (line.includes(':')) {
                    const [key, ...valueParts] = line.split(':');
                    const value = valueParts.join(':').trim().replace(/['"]/g, '');
                    metadata[key.trim()] = value;
                }
                i++;
            }
            
            const contentStart = i + 1;
            const markdownContent = lines.slice(contentStart).join('\n');
            return { metadata, content: markdownContent };
        }

        async function loadPost(filename) {
            try {
                const response = await fetch(`_posts/${filename}`);
                const content = await response.text();
                const { metadata } = parseMarkdownMetadata(content);
                
                if (metadata.published === 'false') return null;
                
                const post = {
                    title: metadata.title || 'Untitled',
                    date: metadata.date || '',
                    tags: (metadata.tags || '').split(',').map(tag => tag.trim()).filter(tag => tag),
                    filename: filename.replace('.md', '.html'),
                    markdownFile: filename
                };
                
                return post;
            } catch (error) {
                console.error(`Error loading post ${filename}:`, error);
                return null;
            }
        }

        async function loadPosts() {
            const postFiles = [
                '2017-10-10-lap-trinh-va-toan-hoc.md',
                '2018-05-12-life-with-robot.md', 
                '2023-03-15-john-pin-problem.md',
                '2023-05-20-open-source-license.md',
                '2023-06-15-mo-hinh-toan.md',
                '2023-08-01-rust-binary-tree-traversal.md'
            ];
            
            const loadPromises = postFiles.map(loadPost);
            const loadedPosts = await Promise.all(loadPromises);
            posts = loadedPosts.filter(post => post !== null);
            
            // Sort by date (newest first)
            posts.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Group by categories/tags
            categories = {};
            posts.forEach(post => {
                post.tags.forEach(tag => {
                    if (!categories[tag]) categories[tag] = [];
                    categories[tag].push(post);
                });
            });
            
            renderPostList();
        }

        function renderPostList() {
            // Render recent posts
            const recentPostsHtml = posts.slice(0, 6).map(post => `
                <li class="post-item">
                    <span class="post-date">${formatDate(post.date)}</span>
                    <a href="#" class="post-title" onclick="showPost('${post.markdownFile}')">${post.title}</a>
                </li>
            `).join('');
            document.getElementById('recent-posts').innerHTML = recentPostsHtml;
            
            // Render categories
            let categoriesHtml = '';
            Object.keys(categories).forEach(category => {
                if (categories[category].length > 0) {
                    categoriesHtml += `
                        <div class="category-header"># ${category.toUpperCase()}</div>
                        <div class="category-posts">
                            <ul class="posts-list">
                                ${categories[category].map(post => `
                                    <li class="post-item">
                                        <span class="post-date">${formatDate(post.date)}</span>
                                        <a href="#" class="post-title" onclick="showPost('${post.markdownFile}')">${post.title}</a>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                    `;
                }
            });
            document.getElementById('categories-section').innerHTML = categoriesHtml;
        }

        async function showPost(filename) {
            try {
                const response = await fetch(`_posts/${filename}`);
                const content = await response.text();
                const { metadata, content: markdownContent } = parseMarkdownMetadata(content);
                
                const htmlContent = marked.parse(markdownContent);
                
                document.getElementById('single-post').innerHTML = `
                    <h1>${metadata.title || 'Untitled'}</h1>
                    <div class="post-meta">
                        <span class="post-date">${formatDate(metadata.date)}</span>
                        ${metadata.tags ? ` | ${metadata.tags}` : ''}
                    </div>
                    <div class="post-body">${htmlContent}</div>
                `;
                
                document.getElementById('post-list').style.display = 'none';
                document.getElementById('post-content').style.display = 'block';
                
                // Highlight code blocks
                document.querySelectorAll('pre code').forEach((block) => {
                    hljs.highlightElement(block);
                });
                
                window.history.pushState({post: filename}, '', `#${filename}`);
            } catch (error) {
                console.error('Error loading post:', error);
            }
        }

        function showPostList() {
            document.getElementById('post-content').style.display = 'none';
            document.getElementById('post-list').style.display = 'block';
            window.history.pushState({}, '', '#');
        }

        window.addEventListener('load', function() {
            loadPosts();
            
            // Handle back/forward navigation
            const hash = window.location.hash.substring(1);
            if (hash && hash.endsWith('.md')) {
                showPost(hash);
            }
        });

        window.addEventListener('popstate', function(event) {
            if (event.state && event.state.post) {
                showPost(event.state.post);
            } else {
                showPostList();
            }
        });
    </script>

    <script src="assets/js/language.js"></script>
    <script>
        const postsData = {
            en: {
                title: "posts: Development Log",
                subtitle: "Technical Blog & Project Documentation",
                recentTitle: "Recently Added",
                categoriesTitle: "Posts by categories",
                breadcrumb: "/posts",
                footer: {
                    quote: "Writing code is like writing a book, debugging is like editing it",
                    github: "‚ö´ GitHub",
                    telegram: "‚úà Telegram", 
                    email: "‚úâ Email"
                }
            },
            vi: {
                title: "b√†i vi·∫øt: Nh·∫≠t k√Ω Ph√°t tri·ªÉn",
                subtitle: "Blog C√¥ng ngh·ªá & T√†i li·ªáu D·ª± √°n",
                recentTitle: "M·ªõi th√™m",
                categoriesTitle: "B√†i vi·∫øt theo danh m·ª•c",
                breadcrumb: "/b√†i-vi·∫øt",
                footer: {
                    quote: "Vi·∫øt m√£ nh∆∞ vi·∫øt s√°ch, debug nh∆∞ bi√™n t·∫≠p",
                    github: "‚ö´ GitHub",
                    telegram: "‚úà Telegram", 
                    email: "‚úâ Email"
                }
            }
        };

        function updatePostsLanguage(lang) {
            const data = postsData[lang];
            
            // Update page content
            const pageTitle = document.querySelector('.page-title');
            const pageSubtitle = document.querySelector('.page-subtitle');
            const breadcrumb = document.querySelector('.breadcrumb');
            
            if (pageTitle) pageTitle.textContent = data.title;
            if (pageSubtitle) pageSubtitle.textContent = data.subtitle;
            if (breadcrumb) breadcrumb.textContent = data.breadcrumb;
            
            // Update section titles
            const sectionTitles = document.querySelectorAll('.section-title');
            if (sectionTitles[0]) sectionTitles[0].textContent = data.recentTitle;
            if (sectionTitles[1]) sectionTitles[1].textContent = data.categoriesTitle;

            // Update navigation
            const navPosts = document.querySelector('nav a[href="posts.html"]');
            if (navPosts) {
                navPosts.textContent = lang === 'vi' ? 'B√†i vi·∫øt' : 'Posts';
            }
            
            // Update footer
            const footer = document.getElementById('footerContent');
            if (footer) {
                footer.innerHTML = `
                    <div class="footer-quote">"${data.footer.quote}"</div>
                    <div class="footer-links">
                        <a href="https://github.com/MH11097">${data.footer.github}</a>
                        <a href="https://t.me/mh11097">${data.footer.telegram}</a>
                        <a href="mailto:minhhieu111097@gmail.com">${data.footer.email}</a>
                    </div>
                `;
            }
        }

        // Listen for language changes
        window.addEventListener('languageChanged', (e) => {
            const content = document.getElementById('blog-content');
            content.classList.add('switching');
            
            setTimeout(() => {
                updatePostsLanguage(e.detail.lang);
                setTimeout(() => {
                    content.classList.remove('switching');
                }, 50);
            }, 200);
        });

        // Initialize on load
        window.addEventListener('DOMContentLoaded', () => {
            updatePostsLanguage(window.languageManager.getCurrentLang());
        });
    </script>
</body>
</html>